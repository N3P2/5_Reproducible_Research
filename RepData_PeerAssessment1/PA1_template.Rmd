---
title: "RepData Peer Assessment 1"
output: html_document
---

## Files and operations
All operations are done on R v3.1.2 in RStudio Desktop 0.98.1102.

All operations are done on R v3.1.2 (64-bit mode) in RStudio Desktop 0.98.1102.

setwd("C:/Users/Qingyuan/Documents/RepData_PeerAssessment1")

## Loading and preprocessing the data
```{r}
unzip(zipfile="activity.zip")
data <- read.csv("activity.csv")
```

## What is mean total number of steps taken per day?
```{r}
library(ggplot2)
total.steps <- tapply(data$steps, data$date, FUN=sum, na.rm=TRUE)
qplot(total.steps,geom_binwidth=1000, xlab="total number of steps taken each day") + geom_histogram(fill="blue")
mean(total.steps, na.rm=TRUE)
median(total.steps, na.rm=TRUE)
```

## What is the average daily activity pattern?
```{r}
library(ggplot2)
averages <- aggregate(x=list(steps=data$steps), by=list(interval=data$interval),
                      FUN=mean, na.rm=TRUE)
ggplot(data=averages, aes(x=interval, y=steps)) +
    geom_line(colour="red") +
    xlab("5-minute interval") +
    ylab("average number of steps taken")
```

On average across all the days in the dataset, the 5-minute interval contains
the maximum number of steps?
```{r}
averages[which.max(averages$steps),]
```

## Imputing missing values

Missing values present within the data set may skew the calculations and bias is introduced as a result. This will affect the accuracy of the results and hence should be taken in consideration when dealing with them.

```{r how_many_missing}
missing <- is.na(data$steps)
table(missing)
```

To fill in with mean value for missing values for that 5-minute interval.

```{r}
# Replace each missing value with the mean value of its 5-minute interval
fill.value <- function(steps, interval) {
    filled <- NA
    if (!is.na(steps))
        filled <- c(steps)
    else
        filled <- (averages[averages$interval==interval, "steps"])
    return(filled)
}
filled.data <- data
filled.data$steps <- mapply(fill.value, filled.data$steps, filled.data$interval)
```
After filling out the missing values, we re-use the data set to create a histogram and recalculate the median and mean of the steps.

```{r}
filled.steps <- tapply(filled.data$steps, filled.data$date, FUN=sum)
# Notice where the missing values from the previous histogram had been distributed
qplot(filled.steps, binwidth=1000, xlab="total number of steps taken each day") + geom_histogram(fill="yellow")

mean(total.steps)
median(total.steps)
```

Notice that the mean and median values are higher after imputing missing data. The missing values coded by "NA" are considered in the count by their values are ignored as there is none assigned to it. This adds to the overall denominator and reducing the previously calculated mean and median values.

## Are there differences in activity patterns between weekdays and weekends?
First, let's find the day of the week for each measurement in the dataset. In
this part, we use the dataset with the filled-in values.

```{r}
weekday.or.weekend <- function(date) {
    day <- weekdays(date)
    if (day %in% c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday"))
        return("weekday") #should any of the above days be found, it wil be reclassified as weekday
    else if (day %in% c("Saturday", "Sunday"))
        return("weekend") #if Sat and Sun are found, then it will be reclassified as weekend.
    else
        stop("invalid date")
}
filled.data$date <- as.Date(filled.data$date)
filled.data$day <- sapply(filled.data$date, FUN=weekday.or.weekend)
```

Now, let's make a panel plot containing plots of average number of steps taken
on weekdays and weekends.
```{r}
averages <- aggregate(steps ~ interval + day, data=filled.data, mean)
ggplot(averages, aes(interval, steps)) + geom_line(colour="blue") + facet_grid(day ~ .) +
    xlab("5-minute interval") + ylab("Number of steps")
```